在自动化测试中，鼠标与键盘操作是高级交互的重要组成部分。Playwright 提供了强大的 API，支持模拟用户的各种操作，例如 **悬停**、**拖拽**、**双击**、**右键点击** 以及 **键盘输入和组合键操作**。相比 Selenium，Playwright 提供了更高的灵活性、更优雅的 API 设计和更稳定的行为模拟。

本篇文章将深入讲解 Playwright 中的鼠标与键盘操作，通过丰富的示例代码展示其强大功能，同时对比 Selenium 的实现，突显 Playwright 的优势。

---

## 1. Playwright 鼠标操作的优势

1. **精确的控制**：Playwright 提供了 `mouse` 对象，可以精确控制鼠标的位置、移动轨迹和点击行为。
2. **自动等待机制**：鼠标操作会自动等待目标元素的加载和交互状态，无需显式等待。
3. **灵活的事件支持**：支持常见操作如点击、双击、右键点击，以及复杂操作如拖拽和多点点击。
4. **模拟真实用户行为**：鼠标移动可通过轨迹模拟，增加操作的真实性。

---

## 2. 鼠标操作详解

### **2.1 单击（点击元素）**

鼠标点击是最基础的操作之一，Playwright 提供了两种方式：
- **直接点击元素**：通过 `locator.click()`。
- **鼠标位置点击**：通过 `mouse.click(x, y)`。

**代码示例：点击元素**
```python
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)
    page = browser.new_page()

    page.goto("https://example.com")

    # 方法 1：直接点击元素
    page.locator("button#submit").click()

    # 方法 2：通过鼠标点击坐标
    page.mouse.click(100, 200)  # 点击页面上的 (100, 200) 坐标

    browser.close()
```

---

### **2.2 悬停（Hover）**

悬停操作可以触发工具提示、显示下拉菜单等行为。Playwright 提供了 `locator.hover()` 方法，能够自动等待元素可见后执行悬停。

**代码示例：悬停到菜单按钮**
```python
page.locator("button#menu").hover()  # 悬停到菜单按钮
page.locator("a#submenu").click()  # 点击悬停后显示的子菜单
```

---

### **2.3 双击（Double Click）**

双击操作适用于触发特殊行为（如选择文本、打开编辑模式等）。Playwright 提供了 `locator.dblclick()` 方法。

**代码示例：双击文本框**
```python
page.locator("input#edit").dblclick()  # 双击文本框进入编辑模式
```

---

### **2.4 右键点击**

右键点击会触发上下文菜单或其他自定义行为。Playwright 支持通过 `locator.click(button="right")` 实现。

**代码示例：右键点击元素**
```python
page.locator("div#context-menu").click(button="right")  # 右键点击触发上下文菜单
```

---

### **2.5 拖拽（Drag and Drop）**

拖拽是自动化测试中的一个难点，Playwright 提供了 `drag_to` 方法，可以轻松实现拖拽功能。

**代码示例：拖拽元素**
```python
source = page.locator("#draggable")
target = page.locator("#droppable")

source.drag_to(target)  # 将 source 拖拽到 target
```

---

### **2.6 滚动页面**

通过鼠标滚轮进行页面滚动或元素滚动。

**代码示例：向下滚动页面**
```python
page.mouse.wheel(0, 500)  # 向下滚动 500 像素
```

---

## 3. Playwright 键盘操作的优势

1. **精准的按键控制**：支持单键输入、快捷键组合（如 `Ctrl+C`）和功能键（如 `Enter`、`Tab`）。
2. **真实的键盘事件模拟**：通过 `keyboard` 对象，可以精确模拟按键事件，包括按下（`down`）、释放（`up`）和输入（`type`）。
3. **多语言支持**：支持输入特殊字符和多语言文本。

---

## 4. 键盘操作详解

### **4.1 基础按键输入**

使用 `page.keyboard.type()` 方法输入文本，支持模拟逐字输入。

**代码示例：输入用户名和密码**
```python
page.keyboard.type("test_user")  # 输入用户名
page.keyboard.press("Tab")  # 按下 Tab 键切换到下一个输入框
page.keyboard.type("secure_password")  # 输入密码
```

---

### **4.2 模拟快捷键**

通过 `keyboard.press()` 方法可以模拟组合键，例如 `Ctrl+C`, `Ctrl+V`。

**代码示例：复制粘贴文本**
```python
page.locator("textarea#source").click()
page.keyboard.press("Control+A")  # 全选文本
page.keyboard.press("Control+C")  # 复制文本

page.locator("textarea#destination").click()
page.keyboard.press("Control+V")  # 粘贴文本
```

---

### **4.3 模拟按键按下和释放**

Playwright 提供了 `keyboard.down()` 和 `keyboard.up()` 方法，支持更精细的按键控制。

**代码示例：模拟 Shift+Tab**
```python
page.keyboard.down("Shift")  # 按下 Shift 键
page.keyboard.press("Tab")  # 按下 Tab 键
page.keyboard.up("Shift")  # 释放 Shift 键
```

---

### **4.4 输入特殊字符**

支持输入特殊字符，例如 `@`、`#`、`€` 等。

**代码示例：输入特殊字符**
```python
page.keyboard.type("Hello, 世界! €")  # 输入带有特殊字符的文本
```

---

## 5. 实战案例：复杂鼠标与键盘操作

### **场景描述**
1. 打开画板页面。
2. 使用鼠标在画板上画一个矩形。
3. 按下快捷键保存画板内容。

**代码实现**
```python
from playwright.sync_api import sync_playwright

def run(playwright):
    browser = playwright.chromium.launch(headless=False)
    page = browser.new_page()

    # 打开画板页面
    page.goto("https://example.com/drawing")

    # 使用鼠标绘制矩形
    page.mouse.move(100, 100)  # 移动到起点
    page.mouse.down()  # 按下鼠标左键
    page.mouse.move(200, 100)  # 向右移动
    page.mouse.move(200, 200)  # 向下移动
    page.mouse.move(100, 200)  # 向左移动
    page.mouse.move(100, 100)  # 回到起点
    page.mouse.up()  # 释放鼠标左键

    # 按下快捷键保存
    page.keyboard.press("Control+S")  # 模拟 Ctrl+S

    browser.close()

with sync_playwright() as playwright:
    run(playwright)
```

---

## 6. 与 Selenium 的对比

| **功能**               | **Playwright**                                   | **Selenium**                                                                 |
|------------------------|--------------------------------------------------|------------------------------------------------------------------------------|
| 鼠标移动轨迹模拟       | 支持平滑移动轨迹，模拟真实用户操作               | 不支持轨迹模拟，只能直接跳到目标位置                                         |
| 鼠标悬停               | `locator.hover()` 自动等待目标可见               | 需要显式等待目标加载完成                                                    |
| 拖拽操作               | 提供 `drag_to()`，简单易用                      | 需复杂模拟按下、移动和释放的过程                                            |
| 快捷键组合             | 支持 `keyboard.press()`，简单直观               | 需通过 `send_keys(Keys.CONTROL, 'C')` 等方式操作                            |
| 输入特殊字符           | 支持多语言文本和特殊字符                        | 部分特殊字符和多语言输入难以实现                                            |
| 操作简洁性             | 链式调用，API 简洁高效                          | 需要频繁切换上下文，代码冗长                                                |

---

## 7. 常见问题及解决思路

### **问题 1**：鼠标悬停无效
**解决方案**：确保目标元素在页面中可见，可以调用 `scroll_into_view_if_needed()` 滚动到目标元素。

### **问题 2**：键盘操作未触发事件
**解决方案**：检查事件监听是否绑定正确，必要时触发 `evaluate` 模拟事件：
```python
page.evaluate("document.querySelector('input#target').dispatchEvent(new KeyboardEvent('keydown', {'key': 'Enter'}))")
```

### **问题 3**：拖拽操作失败
**解决方案**：确保目标元素加载完成，使用 `wait_for_selector` 等待：
```python
source = page.locator("#draggable").wait_for()
target = page.locator("#droppable").wait_for()
source.drag_to(target)
```

---

## 8. 小结

本篇文章全面介绍了 Playwright 中的鼠标和键盘操作，从基础的单击、双击到高级的拖拽和快捷键模拟，结合实战案例展示了 Playwright 的强大功能。通过对比 Selenium，我们可以看到 Playwright 的 API 更加简洁直观，操作更加灵活稳定。

### **亮点**：
- 详细讲解了鼠标和键盘操作的各种场景。
- 提供了实战案例，帮助用户快速上手。
- 对比 Selenium，突出了 Playwright 的高效性和优势。

---

**预告**：在下一篇文章中，我们将探讨 **截图与录屏功能**，包括如何对页面或元素截图、如何录制页面交互视频，以及它们在调试中的重要作用。敬请期待！